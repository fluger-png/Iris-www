{% layout 'theme' %}

{{ 'section-main-product.css' | asset_url | stylesheet_tag }}

<div class="page-width" style="max-width:1000px;margin:0 auto;padding:28px 16px;">
  <h1 class="title title--primary" style="margin:0 0 14px;">IRIS Passport</h1>

  <div id="iris-passport" class="product grid grid--1-col grid--2-col-tablet" style="gap:24px;">
    <div class="grid__item">
      <div class="media media--transparent" style="aspect-ratio:1/1;border:1px solid #eee;background:#f3f4f6;">
        <img id="iris-passport-img" src="" alt="" style="width:100%;height:100%;object-fit:cover;display:none;">
      </div>
    </div>
    <div class="grid__item">
      <div class="product__info-container">
        <h2 id="iris-passport-title" class="h1" style="margin:0 0 10px;">IRIS #</h2>
        <div class="rte" style="font-size:14px;line-height:1.6;">
          <div><strong>Status:</strong> <span id="iris-passport-status">-</span></div>
          <div><strong>Activated:</strong> <span id="iris-passport-activated">-</span></div>
          <div><strong>Rarity:</strong> <span id="iris-passport-rarity">Hidden until activated</span></div>
          <div id="iris-passport-proof" style="margin-top:10px;" hidden>
            <a id="iris-passport-proof-link" href="#" target="_blank" rel="noreferrer">Verify rarity proof</a>
          </div>
        </div>
        <div style="margin-top:18px;">
          <a href="/pages/iris-archive" class="button">Back to Archive</a>
        </div>
      </div>
    </div>
  </div>

  <p id="iris-passport-error" hidden style="margin-top:18px;color:#b00020;">IRIS not found.</p>
</div>

<script>
  (function () {
    var params = new URLSearchParams(window.location.search);
    var irisId = params.get('iris_id');
    var token = params.get('token');
    var error = document.getElementById('iris-passport-error');
    var title = document.getElementById('iris-passport-title');
    var statusEl = document.getElementById('iris-passport-status');
    var activatedEl = document.getElementById('iris-passport-activated');
    var rarityEl = document.getElementById('iris-passport-rarity');
    var img = document.getElementById('iris-passport-img');

    if (!irisId) {
      error.hidden = false;
      return;
    }

    function labelFromId(id) {
      var clean = id.replace(/^IRIS-?/i, '').trim();
      return 'IRIS # ' + clean;
    }

    var url = '/apps/iris/iris/' + encodeURIComponent(irisId);
    if (token) url += '?token=' + encodeURIComponent(token);

    fetch(url, { headers: { 'Accept': 'application/json' } })
      .then(function (res) {
        if (!res.ok) throw new Error('not_found');
        return res.json();
      })
      .then(function (data) {
        title.textContent = labelFromId(data.iris_id);
        statusEl.textContent = data.status || '-';
        activatedEl.textContent = data.activated_at ? new Date(data.activated_at).toLocaleDateString() : '-';
        rarityEl.textContent = data.rarity_code || 'Hidden until activated';
        if (data.image_url) {
          img.src = data.image_url;
          img.alt = data.iris_id;
          img.style.display = 'block';
        }
        if (data.proof_url) {
          document.getElementById('iris-passport-proof').hidden = false;
          document.getElementById('iris-passport-proof-link').href = data.proof_url;
        }
      })
      .catch(function () {
        error.hidden = false;
      });
  })();
</script>
